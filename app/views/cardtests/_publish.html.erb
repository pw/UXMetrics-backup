<%= form_with(model: cardtest, local: true, class: "py-4 bg-white rounded shadow px-4 my-4", id:"publish-form") do |form| %>
<%= render "shared/flash", flash: cardtest.errors %>

<div class="field hidden">
  <%= form.hidden_field :status, id:"status-field", class: "input"%>
  <%# <%= form.hidden_field :uid %>
</div>

  <% begin %>
    <% if cardtest.status == "draft" %>
      <h4 class="mt-2 mb-3 font-semibold px-2 text-center">👍 Nice one, your cardtest has been created!</h4>
        <p class="text-sm text-center py-2 mb-4">When you are ready to publish it just hit the button below!</p>

      <%= form.submit class: "btn btn--primary w-full", value:"Publish", id:"publish-test"%>
      <p class="text-xs text-center py-2"><strong>Note:</strong> You won't be able to make any changes once the test is published.</p>
    <% elsif cardtest.status == "published" %>

    <h4 class="mt-2 mb-6 font-semibold px-2 text-center">🎉 Your cardtest is <span class="text-green-700">published</span> and accepting responses.</h1>
      <p class="text-sm text-center py-2">Copy the link below to share your test with participants.</p>
      <div class="fields-inline items-end">
        <div class="field">
          <input type="text" id="share-link" class="input rounded-r-none" value="<%= request.base_url %>/collect/<%= @cardtest.auth_token %>"/>
        </div>
        <div class="field w-auto">
          <a href="#" class="copy-to-clipboard btn btn--primary rounded-l-none"><i class="fa fa-files-o" aria-hidden="true"></i>
          </a>
        </div>



      </div>

      <p class="copied-text hidden -mt-4 mb-4 text-sm text-green-600 text-center">Share link copied to your clipboard.</p>

      <%= form.submit class: "btn btn--tertiary w-full end-test", value:"End test", id:"publish-test" %>
    <% else %>
    <h4 class="mt-2 mb-6 font-semibold px-2 text-center">🏁 Your cardtest has <span class="text-red-500">ended</span>.</h1>
      <% if @results.count > 0 %>
        <p class="text-sm text-center py-2">You can view results in your report.</p>
      <% else %>


      <% end %>

      <div class="fields-inline items-end">

          <% @results = Result.where(cardtest_id: cardtest.id) %>

          <% if @results.count > 0 %>
            <%= link_to cardtest_results_path(cardtest_uid: cardtest.uid), class:"ml-2 btn btn--secondary w-full" do %>
            <i class="mr-2 fa fa-bar-chart" aria-hidden="true"></i> View report
            <% end %>
          <% else %>


          <% end %>




      </div>
    <% end %>
  <% rescue => ex %>

  <% end %>



<% end %>
